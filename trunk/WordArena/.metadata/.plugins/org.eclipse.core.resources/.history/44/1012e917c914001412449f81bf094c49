package com.slamdunk.toolkit.animation;

import com.badlogic.gdx.graphics.g2d.Animation;
import com.badlogic.gdx.graphics.g2d.SpriteBatch;
import com.badlogic.gdx.graphics.g2d.TextureRegion;
import com.badlogic.gdx.scenes.scene2d.Actor;

public class Animator {
	/**
	 * Timer pour les animations
	 */
	private float stateTime = 0.0f;
	
	/**
	 * Animation permanente
	 */
	private Animation animation;
	private boolean isAnimationActive = false;
	
	/**
	 * Animation temporaire
	 */
	private Animation animationMomentary;
	private boolean isAnimationMomentaryActive = false;
	private boolean isAnimationMomentaryFinished = true;
	
	/**
	 * Variables de contrôle de l'animation
	 */
	private boolean isAnimationLooping = false;
	private boolean killAllAnimations = false;
	
	/**
	 * Dessine l'animation dans le batch indiqué, à la position
	 * de l'acteur
	 * @param actor
	 * @param batch
	 */
	public void draw(Actor actor, SpriteBatch batch) {
		// Dessine l'animation, uniquement si elle est active et non nulle
		if (isAnimationActive && animation != null) {
			// Get frame by frame and animate
			TextureRegion keyFrame = animation.getKeyFrame(stateTime, isAnimationLooping);

			// Draw it due to actors' settings
			batch.draw(keyFrame,
				actor.getX(), actor.getY(), 
				actor.getOriginX(), actor.getOriginY(),
				actor.getWidth(), actor.getHeight(), 
				actor.getScaleX(), actor.getScaleY(),
				actor.getRotation());

			if (animation.isAnimationFinished(stateTime)) {
				if (killAllAnimations) {
					isAnimationActive = false;
				}
			}
		}
		
		// Dessine l'animation ponctuelle, uniquement si elle est active et non nulle
		if (isAnimationMomentaryActive && animationMomentary != null) {
			if (animationMomentary.isAnimationFinished(stateTime)) {
				if (!killAllAnimations) {
					isAnimationActive = true;
					isAnimationMomentaryActive = false;
					isAnimationMomentaryFinished = true;
					startTime = 0;
				} else {
					isAnimationActive = false;
					isAnimationMomentaryActive = false;
					isAnimationMomentaryFinished = true;
					startTime = 0;
				}
			}

			if (isAnimationMomentaryActive) {
				// Get frame by frame and animate
				TextureRegion keyFrame = animationMomentary.getKeyFrame(
						stateTime, false);

				// Draw it due to actors' settings
				batch.draw(keyFrame,
					actor.getX(), actor.getY(), 
					actor.getOriginX(), actor.getOriginY(),
					actor.getWidth(), actor.getHeight(), 
					actor.getScaleX(), actor.getScaleY(),
					actor.getRotation());
			}
		}
	}
}
